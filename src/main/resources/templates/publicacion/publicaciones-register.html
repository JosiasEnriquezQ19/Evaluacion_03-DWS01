<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout('Nueva Publicación', ~{::main})}">

<main class="py-4 bg-light">
    <div class="container">

        <!-- Header -->
        <div class="d-flex align-items-center mb-4">
            <a th:href="@{/publicacion}" class="btn btn-outline-secondary me-3">
                <i class="bi bi-arrow-left"></i>
            </a>
            <div>
                <h2 class="fw-bold mb-1"><i class="bi bi-plus-circle text-success me-2"></i>Nueva Publicación</h2>
                <p class="text-muted mb-0">Crear entrada (RF7.5)</p>
            </div>
        </div>

        <!-- FORMULARIO PRINCIPAL -->
        <div class="card shadow-sm border-0 rounded-4">
            <div class="card-body p-4">

                        <form th:action="@{/publicacion/nuevo}" method="post" th:object="${publicacion}" id="publicacionForm" class="row g-4">

                            <!-- Título -->
                            <div class="col-12">
                                <label class="form-label fw-semibold required" for="titulo">Título</label>
                                <input type="text" id="titulo" minlength="10" maxlength="100" required
                                       class="form-control" th:field="*{titulo}" placeholder="Título de la publicación">
                                <div class="d-flex justify-content-between small mt-1">
                                    <span class="text-muted">10–100 caracteres</span>
                                    <span id="tituloCounter" class="text-muted">0/100</span>
                                </div>
                            </div>

                            <!-- Autor -->
                            <div class="col-md-6">
                                <label for="autorId" class="form-label fw-semibold required">Autor</label>
                                <select id="autorId" class="form-select" th:field="*{autorId}" required>
                                    <option value="">Selecciona...</option>
                                    <option th:each="autor : ${autores}" th:value="${autor.id}" th:text="${autor.nombre}"></option>
                                </select>
                            </div>

                            <!-- Estado -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold required">Estado</label>
                                <select class="form-select" th:field="*{estado}">
                                    <option value="BORRADOR">Borrador</option>
                                    <option value="PUBLICADO">Publicado</option>
                                    <option value="ARCHIVADO">Archivado</option>
                                </select>
                            </div>

                            <!-- Contenido -->
                            <div class="col-12">
                                <label for="contenido" class="form-label fw-semibold required">Contenido</label>
                                <textarea id="contenido" rows="5" minlength="100" maxlength="2000" required
                                          class="form-control" th:field="*{contenido}" placeholder="Contenido completo..."></textarea>
                                <div class="d-flex justify-content-between small mt-1">
                                    <span class="text-muted">100–2000 caracteres</span>
                                    <span id="contenidoCounter" class="text-muted">0/2000</span>
                                </div>
                            </div>

                            <!-- Fechas -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Fecha de Publicación</label>
                                <div class="alert alert-info border-0 py-2 mb-0">
                                    <small><i class="bi bi-info-circle me-1"></i><strong>Automática:</strong> Se asignará al cambiar a "Publicado"</small>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Última Modificación</label>
                                <input type="datetime-local" class="form-control" th:field="*{fechaModificacion}" readonly>
                            </div>

                            <!-- Botones -->
                            <div class="col-12 d-flex gap-3 pt-2">
                                <a th:href="@{/publicacion}" class="btn btn-outline-secondary w-100">Cancelar</a>
                                <button type="submit" name="action" value="draft" class="btn btn-outline-primary w-100">Guardar Borrador</button>
                                <button type="submit" name="action" value="publish" class="btn btn-success w-100">Publicar</button>
                            </div>

                        </form>
                    </div>
                </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const titulo = document.getElementById('titulo');
            const contenido = document.getElementById('contenido');
            const tituloCounter = document.getElementById('tituloCounter');
            const contenidoCounter = document.getElementById('contenidoCounter');

            // Contadores de caracteres
            titulo?.addEventListener('input', e => {
                tituloCounter.textContent = `${e.target.value.length}/100`;
            });

            contenido?.addEventListener('input', e => {
                contenidoCounter.textContent = `${e.target.value.length}/2000`;
            });
        });
    </script>
</main>

</html>
